@{
    ViewBag.Title = "Add New Book";
}
<a asp-controller="Folder"
   asp-action="Index"
   asp-route-id="@ViewBag.FolderId"
   class="btn btn-secondary">
    <i class="fas fa-arrow-left me-1"></i>
    Back to Folder
</a>

<div class="page-header">
    <h2><i class="fas fa-plus-circle me-2"></i>Add New Book</h2>
</div>

<div class="form-container">
    <form asp-action="Create" method="post" enctype="multipart/form-data">
        @Html.AntiForgeryToken()

        <!-- مهم جداً: عشان الكتاب يتحفظ جوه الفولدر الحالي -->
        <input type="hidden" name="folderId" value="@ViewBag.FolderId" />

        <!-- Title -->
        <div class="mb-4">
            <label class="form-label"><i class="fas fa-heading me-2"></i>Title</label>
            <input name="title" class="form-control" placeholder="Enter book title" required />
        </div>

        <!-- Author -->
        <div class="mb-4">
            <label class="form-label"><i class="fas fa-user-edit me-2"></i>Author</label>
            <input name="author" class="form-control" placeholder="Enter author name" required />
        </div>

        <!-- Description -->
        <div class="mb-4">
            <label class="form-label"><i class="fas fa-align-left me-2"></i>Description</label>
            <textarea name="description" class="form-control" placeholder="Enter book description"></textarea>
        </div>

        <!-- Drag & Drop: Book File -->
        <div class="mb-4">
            <label class="form-label"><i class="fas fa-file-upload me-2"></i>Book File</label>

            <div class="drop-zone" id="bookDropZone">
                <p><i class="fas fa-file me-2"></i>Drag & Drop the book file here</p>
                <p style="font-size: 13px; color: #999;">or click to select</p>
            </div>

            <!-- الـ input الحقيقي اللي هيتم إرساله في الفورم -->
            <input type="file" name="file" id="bookFileInput" class="form-control d-none" required />
        </div>

        <!-- Drag & Drop: Cover Image -->
        <div class="mb-4">
            <label class="form-label"><i class="fas fa-image me-2"></i>Cover Image (optional)</label>

            <div class="drop-zone" id="coverDropZone">
                <p><i class="fas fa-image me-2"></i>Drag & Drop the cover image here</p>
                <p style="font-size: 13px; color: #999;">or click to select</p>
            </div>

            <input type="file" name="coverImage" id="coverFileInput" class="form-control d-none" />
        </div>

        <!-- Buttons -->
        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-success">
                <i class="fas fa-save me-2"></i>Save
            </button>

            <a asp-action="Index"
               asp-route-folderId="@ViewBag.FolderId"
               class="btn btn-secondary">
                <i class="fas fa-times me-2"></i>Cancel
            </a>
        </div>
    </form>
</div>

<!-- ========== Drag & Drop Styles ========== -->
<style>
    .drop-zone {
        border: 2px dashed #888;
        padding: 24px;
        border-radius: 10px;
        text-align: center;
        cursor: pointer;
        transition: 0.3s ease;
        background-color: #fafafa;
    }

        .drop-zone.dragover {
            background-color: #e3e7ff;
            border-color: #4c6ef5;
        }

        .drop-zone p {
            margin: 0;
            color: #555;
            font-size: 15px;
        }
</style>

<!-- ========== Drag & Drop Script ========== -->
<script>
    // ===== Book file drag & drop =====
    const bookDropZone = document.getElementById("bookDropZone");
    const bookFileInput = document.getElementById("bookFileInput");

    bookDropZone.addEventListener("click", () => bookFileInput.click());

    bookDropZone.addEventListener("dragover", (event) => {
        event.preventDefault();
        bookDropZone.classList.add("dragover");
    });

    bookDropZone.addEventListener("dragleave", () => {
        bookDropZone.classList.remove("dragover");
    });

    bookDropZone.addEventListener("drop", (event) => {
        event.preventDefault();
        bookDropZone.classList.remove("dragover");

        if (event.dataTransfer.files.length > 0) {
            bookFileInput.files = event.dataTransfer.files;

            const file = event.dataTransfer.files[0];
            bookDropZone.innerHTML = `
                <p><strong>${file.name}</strong></p>
                <p style="font-size: 13px; color: #999;">File selected</p>
            `;
        }
    });

    // ===== Cover image drag & drop =====
    const coverDropZone = document.getElementById("coverDropZone");
    const coverFileInput = document.getElementById("coverFileInput");

    coverDropZone.addEventListener("click", () => coverFileInput.click());

    coverDropZone.addEventListener("dragover", (event) => {
        event.preventDefault();
        coverDropZone.classList.add("dragover");
    });

    coverDropZone.addEventListener("dragleave", () => {
        coverDropZone.classList.remove("dragover");
    });

    coverDropZone.addEventListener("drop", (event) => {
        event.preventDefault();
        coverDropZone.classList.remove("dragover");

        if (event.dataTransfer.files.length > 0) {
            coverFileInput.files = event.dataTransfer.files;

            const file = event.dataTransfer.files[0];
            coverDropZone.innerHTML = `
                <p><strong>${file.name}</strong></p>
                <p style="font-size: 13px; color: #999;">Cover selected</p>
            `;
        }
    });
</script>
